<div class="container mt-4 mb-5 fade-in">
  <h2 class="fw-bold mb-4">Configurações da Loja</h2>

  <div class="card border-0 shadow-sm">
    <div class="card-body p-4">

      <div *ngIf="isLoading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status"></div>
      </div>

      <form *ngIf="!isLoading" (ngSubmit)="onSubmit()">

        <h5 class="text-primary mb-3"><i class="bi bi-geo-alt-fill"></i> Endereço de Estoque (Origem)</h5>
        <p class="text-muted small">Este endereço será usado para calcular o frete dos seus produtos.</p>

        <div class="row g-3 mb-4">
          <div class="col-md-3">
            <label class="form-label">CEP *</label>
            <input type="text" class="form-control" [(ngModel)]="config.zipCode" name="zipCode" mask="00000-000" required (blur)="buscarCep()">
          </div>
          <div class="col-md-7">
            <label class="form-label">Rua *</label>
            <input type="text" class="form-control" [(ngModel)]="config.street" name="street" required>
          </div>
          <div class="col-md-2">
            <label class="form-label">Número *</label>
            <input type="text" class="form-control" [(ngModel)]="config.number" name="number" required>
          </div>
          <div class="col-md-4">
            <label class="form-label">Bairro *</label>
            <input type="text" class="form-control" [(ngModel)]="config.neighborhood" name="neighborhood" required>
          </div>
          <div class="col-md-4">
            <label class="form-label">Cidade *</label>
            <input type="text" class="form-control" [(ngModel)]="config.city" name="city" required>
          </div>
          <div class="col-md-4">
            <label class="form-label">Estado (UF) *</label>
            <select class="form-select" [(ngModel)]="config.state" name="state" required>
              <option value="" disabled>Selecione</option>
              <option *ngFor="let uf of ufs" [value]="uf">{{ uf }}</option>
            </select>
          </div>
          <div class="col-12">
            <label class="form-label">Complemento</label>
            <input type="text" class="form-control" [(ngModel)]="config.complement" name="complement">
          </div>
        </div>

        <hr class="my-4">

        <h5 class="text-success mb-3"><i class="bi bi-box-seam"></i> Integração Melhor Envio (Opcional)</h5>
        <div class="alert alert-light border d-flex gap-3 align-items-center">
            <i class="bi bi-info-circle text-primary fs-4"></i>
            <div>
                <small class="d-block text-muted">Se você possui conta no Melhor Envio, cole seu Token abaixo para oferecer fretes competitivos.</small>
                <small class="d-block text-muted">Caso contrário, o sistema usará a tabela padrão dos Correios.</small>
            </div>
        </div>

        <div class="mb-4">
            <label class="form-label">Token de Acesso (Access Token)</label>
            <textarea class="form-control font-monospace bg-light" rows="3"
                      [(ngModel)]="config.melhorEnvioToken" name="token"
                      placeholder="eyJhbGciOiJIUzI1Ni..."></textarea>
        </div>

        <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-primary px-5" [disabled]="isSaving">
                <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2"></span>
                Salvar Configurações
            </button>
        </div>

      </form>
    </div>
  </div>
</div>
