<div class="container mt-4">
  <h2 class="mb-4"><i class="bi bi-clock-history"></i> Meus Pedidos</h2>

  <div *ngIf="orders.length === 0" class="alert alert-warning">
    Você ainda não fez nenhum pedido.
  </div>

  <div class="accordion" id="accordionOrders">
    <div class="accordion-item" *ngFor="let order of orders; let i = index">

      <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#order'+i">
          <span class="badge bg-secondary me-3">{{ order.creationDate | date:'dd/MM/yyyy HH:mm' }}</span>

          <strong class="me-2">Status: {{ order.status }}</strong>

          <i *ngIf="order.status === 'WAITING_PAYMENT'"
             class="bi bi-exclamation-triangle-fill text-warning me-3"
             title="Pagamento Pendente"></i>

          <span class="ms-auto text-success fw-bold">{{ getTotal(order) | currency:'BRL' }}</span>
        </button>
      </h2>

      <div [id]="'order'+i" class="accordion-collapse collapse" data-bs-parent="#accordionOrders">
        <div class="accordion-body">

          <div class="alert alert-light border mb-3" *ngIf="order.address">
            <h6 class="fw-bold mb-1"><i class="bi bi-geo-alt-fill text-danger"></i> Endereço de Entrega:</h6>
            <span class="text-muted small">
              {{ order.address.street }}, {{ order.address.number }}
              <span *ngIf="order.address.complement"> - {{ order.address.complement }}</span>
              <br>
              {{ order.address.neighborhood }} - {{ order.address.city }}/{{ order.address.state }}
              <br>
              CEP: {{ order.address.zipCode }}
            </span>
          </div>

          <ul class="list-group list-group-flush border-top">
            <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let item of order.items">
              <div class="d-flex align-items-center">
                <i class="bi bi-box-seam me-2 text-muted"></i>
                <span><span class="fw-bold">{{ item.quantity }}x</span> {{ item.product.name }}</span>
              </div>
              <span class="text-muted">{{ item.price | currency:'BRL' }}</span>
            </li>
          </ul>

          <div class="mt-3 text-end pt-3 border-top" *ngIf="order.status === 'WAITING_PAYMENT'">
             <span class="text-muted me-3 small align-middle">O pedido ainda não foi pago.</span>
             <button class="btn btn-success" (click)="pay(order.id)">
               <i class="bi bi-credit-card"></i> Pagar Agora (Simulação)
             </button>
          </div>

          <div class="mt-3 text-end pt-3 border-top" *ngIf="order.status === 'PAID'">
            <span class="text-success fw-bold">
              <i class="bi bi-check-circle-fill"></i> Pagamento Aprovado
            </span>
         </div>

        </div>
      </div>

    </div>
  </div>

  <div class="mt-4">
      <a routerLink="/" class="btn btn-outline-primary">
        <i class="bi bi-arrow-left"></i> Voltar para Loja
      </a>
  </div>
</div>
